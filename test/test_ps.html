<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>

  <body>
    <svg id="map"></svg>
    <svg id="map1"></svg>
    <svg id="map2"></svg>
    <svg id="map3"></svg>
    <svg id="map4"></svg>
    <svg id="map5"></svg>
    <svg id="map6"></svg>

    <script src="../build/eurostatmap.js"></script>
    <script src="https://d3js.org/d3-format.v2.min.js"></script>
    <!-- for custom symbol -->
    <script src="https://d3js.org/d3-path.v2.min.js"></script>
    <script src="https://d3js.org/d3-shape.v2.min.js"></script>
    

    <script>
      let format = d3.format(".2s");

      //Custom Semi Circle, accurate center and size
      let customShapeCircle = {
        draw: function (context, size) {
          let r = Math.sqrt((2 * size) / Math.PI);
          let orgin = (4 * r) / (3 * Math.PI); //the orgin of the circle, not of the symbol
          context.arc(0, -orgin, r, Math.PI, 2 * Math.PI, true);
          context.closePath();
        },
      };

      let customCircle = d3.symbol().type(customShapeCircle);

      // circles
      eurostatmap
        .map("ps")
        .nutsLvl(0)
        //GDP per inhabitant
        .stat("color", { eurostatDatasetCode: "nama_10r_3gdp", unitText: "GDP", filters: { unit: "EUR_HAB", time: "2018", filterNonGeo: "1" } })
        // total GDP
        .stat("size", { eurostatDatasetCode: "nama_10r_3gdp", unitText: "GDP", filters: { unit: "MIO_EUR", time: "2018", filterNonGeo: "1" } })
        .psShape("circle") // cross, diamond, star, square, wye, circle, triangle, rectangle https://github.com/d3/d3-shape#symbols
        .psMaxSize(60)
        .psFill("#84d8c3")
        .psStroke("black")
        .psStrokeWidth("1")
        .tooltipShowFlags("long")
        .legend({
          x: 600,
          ascending: false,
          sizeLegend: {
            title: "GDP (million EUR)",
            cellNb: 4,
            format: d3.format(",.2r"),
            shapePadding: 6,
            labelOffset: 40,
          },
          colorLegend: {
            title: "GDP per inhabitant (EUR)",
            format: d3.format(",.2r"),
          },
        })
        .build();

      // semi-circles
      eurostatmap
        .map("ps")
        .svgId("map1")
        
        .nutsLvl(1)
        .stat({ eurostatDatasetCode: "demo_r_pjangrp3", filters: { age: "TOTAL", sex: "T", unit: "NR", time: 2016 }, unitText: "inhabitants" })
        .psShape("custom")
        .psCustomShape(customCircle)
        .psMaxSize(15)
        .psFill("red")
        .psStroke("black")
        .psStrokeWidth("1")
        .tooltipShowFlags("long")
        .legend({
          sizeLegend: {
            title: "Population",
            cellNb: 6,
            format: d3.format(",.2r"),
            x: 350,
            ascending: false,
          },
        })
        .build();

      // // vertical bars
      eurostatmap
        .map("ps")
       
        .svgId("map2")
        .nutsLvl(0)
        .stat("size", { eurostatDatasetCode: "demo_r_pjangrp3", filters: { age: "TOTAL", sex: "T", unit: "NR", time: 2016 }, unitText: "inhabitants" })
        .psShape("bar") // cross, diamond, star, square, wye, circle, triangle, bar https://github.com/d3/d3-shape#symbols
        .psFill("#35aeff")
        .psMaxSize(70)
        .psStroke("black")
        .psStrokeWidth("1")
        .tooltipShowFlags("long")
        .legend({
          sizeLegend: {
            title: "Population",
            cellNb: 3,
            format: format,
          },
        })
        .build();

      // // diamond
      eurostatmap
        .map("ps")
        
        .svgId("map3")
        .nutsLvl(0)
        .title("Tourism August 2020")
        .stat("size", { eurostatDatasetCode: "tour_occ_nim", filters: { c_resid: "TOTAL", unit: "NR", time: "2020M08", geo:"AL&geo=AT&geo=BE&geo=BG&geo=CH&geo=CY&geo=CZ&geo=DE&geo=DK&geo=EE&geo=EL&geo=ES&geo=FI&geo=FR&geo=HR&geo=HU&geo=IE&geo=IS&geo=IT&geo=LI&geo=LT&geo=LU&geo=LV&geo=ME&geo=MK&geo=MT&geo=NL&geo=NO&geo=PL&geo=PT&geo=RO&geo=RS&geo=SE&geo=SI&geo=SK&geo=TR&geo=UK" }, unitText: "total nights spent" })
        .stat("color", { eurostatDatasetCode: "tour_occ_nim", filters: { c_resid: "TOTAL", unit: "PCH_SM", time: "2020M08", geo:"AL&geo=AT&geo=BE&geo=BG&geo=CH&geo=CY&geo=CZ&geo=DE&geo=DK&geo=EE&geo=EL&geo=ES&geo=FI&geo=FR&geo=HR&geo=HU&geo=IE&geo=IS&geo=IT&geo=LI&geo=LT&geo=LU&geo=LV&geo=ME&geo=MK&geo=MT&geo=NL&geo=NO&geo=PL&geo=PT&geo=RO&geo=RS&geo=SE&geo=SI&geo=SK&geo=TR&geo=UK", }, unitText: "% change compared to previous year" })
        .psShape("square") // cross, diamond, star, square, wye, circle, triangle, bar https://github.com/d3/d3-shape#symbols
        .psFill("#fa8dfc")
        .psStroke("black")
        .psStrokeWidth("1")
        .tooltipShowFlags("long")
        .psColorFun(d3.interpolateMagma)
        .legend({
          x:550,
          y:50,
          sizeLegend: {
            title: "Total nights spent",
            cellNb: 3,
            format: format,
          },
          colorLegend: {
            title: "% change compared to 2019",
            shapePadding: 1,
          }
        })
        .build();

      // // cross
      // eurostatmap
      //   .map("ps")
      //   .width(500)
      //   .svgId("map4")
      //   .nutsLvl(0)
      //   .stat({ eurostatDatasetCode: "demo_r_pjangrp3", filters: { age: "TOTAL", sex: "T", unit: "NR", time: 2016 }, unitText: "inhabitants" })
      //   .psShape("cross") // cross, diamond, star, square, wye, circle, triangle, bar https://github.com/d3/d3-shape#symbols
      //   .psFill("red")
      //   .psStroke("black")
      //   .psStrokeWidth("1")
      //   .tooltipShowFlags("long")
      //   .legend({
      //     title: "Population",
      //     cellNb: 3,
      //     shapePadding: 10,
      //     format: format,

      //   })
      //   .build();

      // // wye
      // eurostatmap
      //   .map("ps")
      //   .width(500)
      //   .svgId("map5")
      //   .nutsLvl(0)
      //   .stat({ eurostatDatasetCode: "tec00001","unitText":"GDP", filters: { "na_item":"B1GQ", "unit":"CP_MEUR", "time":"2019", "filterNonGeo":"1" } })
      //   .psShape("wye") // cross, diamond, star, square, wye, circle, triangle, bar https://github.com/d3/d3-shape#symbols
      //   .psFill("blue")
      //   .psStroke("black")
      //   .psStrokeWidth("1")
      //   .tooltipShowFlags("long")
      //   .legend({
      //     title: "GDP (â‚¬ Million), 2019",
      //     cellNb: 3,
      //     shapePadding: 10,
      //     labelOffset: 30,
      //     //format: d3.format(",.2r"),
      //     x: 330,
      //   })
      //   .build();
    </script>
  </body>
</html>
